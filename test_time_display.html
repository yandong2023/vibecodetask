<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¶é—´æ ¼å¼æ˜¾ç¤ºæµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; }
        .test-case { margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .test-input { color: #666; font-family: monospace; }
        .test-output { color: #333; font-weight: bold; }
        .error { color: #d32f2f; }
        .success { color: #388e3c; }
    </style>
</head>
<body>
    <h1>ğŸ• æ—¶é—´æ ¼å¼æ˜¾ç¤ºæµ‹è¯•</h1>
    
    <div id="testResults"></div>

    <script>
        // å¤åˆ¶å‰ç«¯ä¿®å¤åçš„å‡½æ•°
        function formatDateTime(dateTimeStr) {
            if (!dateTimeStr) return '--';
            try {
                const date = new Date(dateTimeStr);
                if (isNaN(date.getTime())) {
                    return dateTimeStr; // è¿”å›åŸå­—ç¬¦ä¸²å¦‚æœè§£æå¤±è´¥
                }
                return date.toLocaleString();
            } catch (e) {
                console.warn('Date parsing error:', e, dateTimeStr);
                return dateTimeStr;
            }
        }

        function getTaskTypeText(task) {
            switch (task.type) {
                case 'immediate': return 'âš¡ ç«‹å³æ‰§è¡Œ';
                case 'scheduled': {
                    if (task.scheduledTime) {
                        try {
                            // å®‰å…¨è§£ææ—¶é—´æ ¼å¼
                            const scheduledDate = new Date(task.scheduledTime);
                            if (isNaN(scheduledDate.getTime())) {
                                return `â° ${task.scheduledTime}`;
                            }
                            return `â° ${scheduledDate.toLocaleString()}`;
                        } catch (e) {
                            return `â° ${task.scheduledTime}`;
                        }
                    }
                    return 'â° å®šæ—¶æ‰§è¡Œ';
                }
                case 'smart': return 'ğŸ¤– æ™ºèƒ½è°ƒåº¦';
                default: return 'â“ æœªçŸ¥';
            }
        }

        // æµ‹è¯•æ•°æ® - ä½¿ç”¨ç”¨æˆ·æä¾›çš„å®é™…æ•°æ®
        const testTask = {
            "id": 5,
            "description": "ç”¨html+js ç”Ÿæˆfly birdæ¸¸æˆ",
            "type": "scheduled",
            "status": "completed",
            "scheduledTime": "2025-08-09T14:15:00",
            "createdAt": "2025-08-09T22:14:19.534048",
            "updatedAt": "2025-08-09T22:15:33.784604",
            "estimatedTokens": 84
        };

        // é¢å¤–æµ‹è¯•æ¡ˆä¾‹
        const testCases = [
            {
                label: "ç”¨æˆ·å®é™…ä»»åŠ¡ - scheduledTime",
                input: testTask.scheduledTime,
                func: formatDateTime
            },
            {
                label: "ç”¨æˆ·å®é™…ä»»åŠ¡ - createdAt",
                input: testTask.createdAt,
                func: formatDateTime
            },
            {
                label: "ç”¨æˆ·å®é™…ä»»åŠ¡ - updatedAt",
                input: testTask.updatedAt,
                func: formatDateTime
            },
            {
                label: "ä»»åŠ¡ç±»å‹æ˜¾ç¤º",
                input: testTask,
                func: getTaskTypeText
            },
            {
                label: "æ ‡å‡†ISOæ ¼å¼",
                input: "2025-08-10T14:30:00",
                func: formatDateTime
            },
            {
                label: "å¸¦æ¯«ç§’çš„ISOæ ¼å¼",
                input: "2025-08-10T14:30:00.123456",
                func: formatDateTime
            },
            {
                label: "å¸¦æ—¶åŒºçš„ISOæ ¼å¼",
                input: "2025-08-10T14:30:00Z",
                func: formatDateTime
            },
            {
                label: "ç©ºå€¼å¤„ç†",
                input: null,
                func: formatDateTime
            },
            {
                label: "æ— æ•ˆæ ¼å¼",
                input: "invalid-date",
                func: formatDateTime
            }
        ];

        function runTests() {
            const resultsDiv = document.getElementById('testResults');
            let html = '';

            testCases.forEach((testCase, index) => {
                try {
                    const result = testCase.func(testCase.input);
                    const isError = result === testCase.input && testCase.input !== null && testCase.input !== undefined;
                    
                    html += `
                        <div class="test-case">
                            <h3>æµ‹è¯• ${index + 1}: ${testCase.label}</h3>
                            <div class="test-input">è¾“å…¥: ${JSON.stringify(testCase.input)}</div>
                            <div class="test-output ${isError ? 'error' : 'success'}">
                                ç»“æœ: ${result}
                                ${isError ? ' (å¯èƒ½æœ‰é—®é¢˜)' : ' âœ…'}
                            </div>
                        </div>
                    `;
                } catch (error) {
                    html += `
                        <div class="test-case">
                            <h3>æµ‹è¯• ${index + 1}: ${testCase.label}</h3>
                            <div class="test-input">è¾“å…¥: ${JSON.stringify(testCase.input)}</div>
                            <div class="test-output error">é”™è¯¯: ${error.message} âŒ</div>
                        </div>
                    `;
                }
            });

            resultsDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæµ‹è¯•
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html>