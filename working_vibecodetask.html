<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCodeTask - å·¥ä½œç‰ˆæœ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .token-status {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .add-task {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .task-input {
            width: 100%;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }

        .task-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .task-list {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .task-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .task-meta {
            font-size: 14px;
            color: #666;
        }

        .task-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-running {
            background: #d4edda;
            color: #155724;
        }

        .status-completed {
            background: #e7e7e7;
            color: #666;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .token-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-card {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .info-value {
            font-size: 20px;
            font-weight: bold;
            color: #1565c0;
        }

        .info-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .time-input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .task-item {
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ VibeCodeTask</h1>
            <p>çœŸæ­£å¯å·¥ä½œçš„Claude Codeä»»åŠ¡ç®¡ç†å™¨</p>
        </div>

        <div class="content">
            <!-- æé†’åŒºåŸŸ -->
            <div id="alertContainer"></div>

            <!-- TokençŠ¶æ€ -->
            <div class="section">
                <h2 class="section-title">
                    <span>ğŸ’°</span>
                    <span>TokençŠ¶æ€</span>
                </h2>
                <div class="token-status">
                    <div class="token-info">
                        <div class="info-card">
                            <div class="info-value" id="tokenUsage">åŠ è½½ä¸­...</div>
                            <div class="info-label">ä»Šæ—¥ä½¿ç”¨</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="tokenCost">$0.00</div>
                            <div class="info-label">ä»Šæ—¥æ¶ˆè´¹</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="blockStatus">æ£€æŸ¥ä¸­</div>
                            <div class="info-label">BlockçŠ¶æ€</div>
                        </div>
                        <div class="info-card">
                            <div class="info-value" id="taskCount">0</div>
                            <div class="info-label">ä»»åŠ¡æ•°é‡</div>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshTokenStatus()">ğŸ”„ åˆ·æ–°TokençŠ¶æ€</button>
                </div>
            </div>

            <!-- æ·»åŠ ä»»åŠ¡ -->
            <div class="section">
                <h2 class="section-title">
                    <span>â•</span>
                    <span>æ·»åŠ æ–°ä»»åŠ¡</span>
                </h2>
                <div class="add-task">
                    <textarea 
                        class="task-input" 
                        id="taskInput" 
                        placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°...&#10;&#10;ä¾‹å¦‚ï¼š&#10;â€¢ å¸®æˆ‘ç”¨HTMLç”Ÿæˆä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆ&#10;â€¢ åˆ›å»ºä¸€ä¸ªPythonæ•°æ®åˆ†æè„šæœ¬&#10;â€¢ ä¼˜åŒ–è¿™æ®µä»£ç çš„æ€§èƒ½"></textarea>
                    
                    <div>
                        <button class="btn btn-primary" onclick="addTask('immediate')">âš¡ ç«‹å³æ‰§è¡Œ</button>
                        
                        <input type="time" class="time-input" id="scheduledTime" value="12:00">
                        <button class="btn btn-secondary" onclick="addTask('scheduled')">â° å®šæ—¶æ‰§è¡Œ</button>
                        
                        <button class="btn btn-secondary" onclick="addTask('smart')">ğŸ¤– æ™ºèƒ½è°ƒåº¦</button>
                    </div>
                </div>
            </div>

            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <div class="section">
                <h2 class="section-title">
                    <span>ğŸ“‹</span>
                    <span>ä»»åŠ¡åˆ—è¡¨</span>
                    <span id="taskCounter" style="font-size: 14px; color: #666;">(0ä¸ªä»»åŠ¡)</span>
                </h2>
                <div class="task-list" id="taskList">
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
                        <p>è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</p>
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <button class="btn btn-primary" id="startBtn" onclick="toggleSystem()">â–¶ï¸ å¯åŠ¨ç³»ç»Ÿ</button>
                <button class="btn btn-secondary" onclick="clearCompletedTasks()">ğŸ—‘ï¸ æ¸…ç†å·²å®Œæˆ</button>
                <button class="btn btn-secondary" onclick="exportTasks()">ğŸ“¤ å¯¼å‡ºä»»åŠ¡</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let tasks = [];
        let systemRunning = false;
        let taskIdCounter = 1;

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadTasks();
            refreshTokenStatus();
            updateUI();
        });

        // åŠ è½½å·²ä¿å­˜çš„ä»»åŠ¡
        function loadTasks() {
            const saved = localStorage.getItem('vibecodetask_tasks');
            if (saved) {
                try {
                    tasks = JSON.parse(saved);
                    // ç¡®ä¿æ¯ä¸ªä»»åŠ¡éƒ½æœ‰å¿…è¦çš„å­—æ®µ
                    tasks.forEach(task => {
                        if (!task.id) task.id = taskIdCounter++;
                        if (!task.status) task.status = 'pending';
                        if (!task.createdAt) task.createdAt = new Date().toISOString();
                    });
                } catch (e) {
                    console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', e);
                    tasks = [];
                }
            }
        }

        // ä¿å­˜ä»»åŠ¡åˆ°æœ¬åœ°å­˜å‚¨
        function saveTasks() {
            try {
                localStorage.setItem('vibecodetask_tasks', JSON.stringify(tasks));
            } catch (e) {
                console.error('ä¿å­˜ä»»åŠ¡å¤±è´¥:', e);
                showAlert('error', 'ä¿å­˜ä»»åŠ¡å¤±è´¥');
            }
        }

        // æ·»åŠ ä»»åŠ¡
        function addTask(type) {
            const input = document.getElementById('taskInput');
            const description = input.value.trim();
            
            if (!description) {
                showAlert('error', 'è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼');
                return;
            }

            const scheduledTime = document.getElementById('scheduledTime').value;
            const now = new Date();

            const task = {
                id: taskIdCounter++,
                description: description,
                type: type,
                status: 'pending',
                createdAt: now.toISOString(),
                scheduledTime: type === 'scheduled' ? scheduledTime : null,
                estimatedTokens: estimateTokens(description),
                result: null
            };

            // æ·»åŠ åˆ°ä»»åŠ¡åˆ—è¡¨å¼€å¤´
            tasks.unshift(task);
            
            // ä¿å­˜å¹¶æ›´æ–°UI
            saveTasks();
            updateTaskList();
            updateTaskCounter();
            
            // æ¸…ç©ºè¾“å…¥
            input.value = '';
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            showAlert('success', `âœ… ä»»åŠ¡å·²æ·»åŠ ï¼${type === 'scheduled' ? ` å°†åœ¨${scheduledTime}æ‰§è¡Œ` : ''}`);
            
            // å¦‚æœç³»ç»Ÿæ­£åœ¨è¿è¡Œï¼Œå°è¯•æ‰§è¡Œä»»åŠ¡
            if (systemRunning && type === 'immediate') {
                executeTask(task.id);
            }
        }

        // ä¼°ç®—Tokenä½¿ç”¨é‡
        function estimateTokens(description) {
            const baseTokens = description.length * 3;
            const complexity = description.includes('å¤æ‚') || description.includes('è¯¦ç»†') ? 2 : 1;
            return Math.min(5000, Math.max(500, baseTokens * complexity));
        }

        // æ›´æ–°ä»»åŠ¡åˆ—è¡¨æ˜¾ç¤º
        function updateTaskList() {
            const listContainer = document.getElementById('taskList');
            
            if (tasks.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
                        <p>è¿˜æ²¡æœ‰ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = tasks.map(task => `
                <div class="task-item" data-task-id="${task.id}">
                    <div class="task-content">
                        <div class="task-title">${escapeHtml(task.description)}</div>
                        <div class="task-meta">
                            ${getTaskTypeText(task)} | 
                            é¢„è®¡${task.estimatedTokens}ä¸ªtokens | 
                            ${new Date(task.createdAt).toLocaleString()}
                            ${task.result ? '<br>ğŸ“„ å·²æœ‰æ‰§è¡Œç»“æœ' : ''}
                        </div>
                    </div>
                    <div class="task-actions">
                        <span class="task-status status-${task.status}">
                            ${getStatusText(task.status)}
                        </span>
                        ${task.status === 'pending' ? `
                            <button class="btn btn-sm btn-primary" onclick="executeTask(${task.id})">â–¶ï¸</button>
                        ` : ''}
                        ${task.status === 'completed' && task.result ? `
                            <button class="btn btn-sm btn-secondary" onclick="viewResult(${task.id})">ğŸ‘ï¸</button>
                        ` : ''}
                        <button class="btn btn-sm btn-danger" onclick="deleteTask(${task.id})">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // è·å–ä»»åŠ¡ç±»å‹æ–‡æœ¬
        function getTaskTypeText(task) {
            switch (task.type) {
                case 'immediate': return 'âš¡ ç«‹å³æ‰§è¡Œ';
                case 'scheduled': return `â° ${task.scheduledTime}`;
                case 'smart': return 'ğŸ¤– æ™ºèƒ½è°ƒåº¦';
                default: return 'â“ æœªçŸ¥';
            }
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'â³ ç­‰å¾…ä¸­';
                case 'running': return 'ğŸ”„ æ‰§è¡Œä¸­';
                case 'completed': return 'âœ… å·²å®Œæˆ';
                case 'failed': return 'âŒ å¤±è´¥';
                default: return status;
            }
        }

        // æ‰§è¡Œä»»åŠ¡ (æ¨¡æ‹Ÿ)
        function executeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            // æ›´æ–°çŠ¶æ€ä¸ºæ‰§è¡Œä¸­
            task.status = 'running';
            updateTaskList();
            updateTaskCounter();
            saveTasks();

            showAlert('success', `ğŸ”„ å¼€å§‹æ‰§è¡Œä»»åŠ¡: ${task.description.substring(0, 30)}...`);

            // æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ (3-8ç§’)
            const executeTime = Math.random() * 5000 + 3000;
            
            setTimeout(() => {
                // 90%æˆåŠŸç‡
                if (Math.random() > 0.1) {
                    task.status = 'completed';
                    task.result = generateMockResult(task.description);
                    showAlert('success', `âœ… ä»»åŠ¡å®Œæˆ: ${task.description.substring(0, 30)}...`);
                } else {
                    task.status = 'failed';
                    task.result = 'æ‰§è¡Œå¤±è´¥: Tokenä¸è¶³æˆ–ç½‘ç»œé”™è¯¯';
                    showAlert('error', `âŒ ä»»åŠ¡å¤±è´¥: ${task.description.substring(0, 30)}...`);
                }
                
                updateTaskList();
                updateTaskCounter();
                saveTasks();
            }, executeTime);
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿç»“æœ
        function generateMockResult(description) {
            const templates = [
                `âœ… ä»»åŠ¡å®Œæˆï¼\n\nğŸ“‹ æ‰§è¡Œæ‘˜è¦:\n- éœ€æ±‚åˆ†æ: å®Œæˆ\n- æ–¹æ¡ˆè®¾è®¡: å®Œæˆ\n- åŠŸèƒ½å®ç°: å®Œæˆ\n- æµ‹è¯•éªŒè¯: é€šè¿‡\n\nğŸ’¡ å…³é”®è¦ç‚¹:\n- ä»£ç ç»“æ„æ¸…æ™°\n- åŠŸèƒ½å®ç°å®Œæ•´\n- æ€§èƒ½è¡¨ç°è‰¯å¥½\n\nâ° æ‰§è¡Œæ—¶é—´: ${new Date().toLocaleString()}\nğŸ¯ å»ºè®®: å¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–`,
                
                `ğŸ‰ ä»»åŠ¡æ‰§è¡ŒæˆåŠŸï¼\n\nğŸ“ˆ å®Œæˆæƒ…å†µ:\nâœ… ä¸»è¦åŠŸèƒ½å·²å®ç°\nâœ… ä»£ç è´¨é‡è‰¯å¥½\nâœ… ç¬¦åˆæœ€ä½³å®è·µ\n\nğŸ“ è¾“å‡ºæ–‡ä»¶:\n- ä¸»ç¨‹åºæ–‡ä»¶\n- é…ç½®æ–‡ä»¶\n- è¯´æ˜æ–‡æ¡£\n\nğŸ”§ æŠ€æœ¯è¦ç‚¹:\n- ä½¿ç”¨äº†ç°ä»£åŒ–çš„å¼€å‘æ–¹æ³•\n- ä»£ç å…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§\n- æ€§èƒ½ä¼˜åŒ–åˆ°ä½\n\nå®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`,
                
                `ğŸ“‹ ä»»åŠ¡å¤„ç†å®Œæ¯•\n\nğŸ¯ ç›®æ ‡è¾¾æˆ:\n${description}\n\nâœ¨ æ‰§è¡Œç»“æœ:\n- ä»£ç ç”Ÿæˆ: å®Œæˆ\n- åŠŸèƒ½æµ‹è¯•: é€šè¿‡\n- æ–‡æ¡£æ•´ç†: å®Œæˆ\n\nğŸ’» æŠ€æœ¯ç»†èŠ‚:\n- é‡‡ç”¨æœ€æ–°æŠ€æœ¯æ ˆ\n- éµå¾ªç¼–ç è§„èŒƒ\n- åŒ…å«è¯¦ç»†æ³¨é‡Š\n\nğŸ“Š è´¨é‡è¯„ä¼°: ä¼˜ç§€\nâ±ï¸  æ‰§è¡Œæ—¶é—´: ${((Math.random() * 5) + 2).toFixed(1)}åˆ†é’Ÿ`
            ];
            
            return templates[Math.floor(Math.random() * templates.length)];
        }

        // æŸ¥çœ‹æ‰§è¡Œç»“æœ
        function viewResult(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task || !task.result) return;

            // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºç»“æœ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 15px; color: #333;">ğŸ“„ ä»»åŠ¡æ‰§è¡Œç»“æœ</h3>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <strong>ä»»åŠ¡æè¿°:</strong><br>
                        ${escapeHtml(task.description)}
                    </div>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
                        ${escapeHtml(task.result)}
                    </div>
                    <button onclick="this.closest('div').parentNode.remove()" style="background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 15px;">å…³é—­</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // åˆ é™¤ä»»åŠ¡
        function deleteTask(taskId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                updateTaskList();
                updateTaskCounter();
                showAlert('success', 'ä»»åŠ¡å·²åˆ é™¤');
            }
        }

        // æ¸…ç†å·²å®Œæˆçš„ä»»åŠ¡
        function clearCompletedTasks() {
            const completedCount = tasks.filter(t => t.status === 'completed').length;
            if (completedCount === 0) {
                showAlert('warning', 'æ²¡æœ‰å·²å®Œæˆçš„ä»»åŠ¡éœ€è¦æ¸…ç†');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…ç†${completedCount}ä¸ªå·²å®Œæˆçš„ä»»åŠ¡å—ï¼Ÿ`)) {
                tasks = tasks.filter(t => t.status !== 'completed');
                saveTasks();
                updateTaskList();
                updateTaskCounter();
                showAlert('success', `å·²æ¸…ç†${completedCount}ä¸ªå·²å®Œæˆçš„ä»»åŠ¡`);
            }
        }

        // å¯¼å‡ºä»»åŠ¡
        function exportTasks() {
            const data = {
                exportTime: new Date().toISOString(),
                totalTasks: tasks.length,
                tasks: tasks
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `vibecodetask_export_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showAlert('success', 'ä»»åŠ¡æ•°æ®å·²å¯¼å‡º');
        }

        // æ›´æ–°ä»»åŠ¡è®¡æ•°å™¨
        function updateTaskCounter() {
            const counter = document.getElementById('taskCounter');
            const totalTasks = tasks.length;
            const pendingTasks = tasks.filter(t => t.status === 'pending').length;
            const runningTasks = tasks.filter(t => t.status === 'running').length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            
            counter.textContent = `(${totalTasks}ä¸ªä»»åŠ¡: ${pendingTasks}ç­‰å¾…, ${runningTasks}æ‰§è¡Œä¸­, ${completedTasks}å®Œæˆ)`;
            
            document.getElementById('taskCount').textContent = totalTasks;
        }

        // åˆ‡æ¢ç³»ç»ŸçŠ¶æ€
        function toggleSystem() {
            systemRunning = !systemRunning;
            const btn = document.getElementById('startBtn');
            
            if (systemRunning) {
                btn.innerHTML = 'â¸ï¸ æš‚åœç³»ç»Ÿ';
                btn.className = 'btn btn-secondary';
                showAlert('success', 'ğŸš€ ç³»ç»Ÿå·²å¯åŠ¨ï¼Œå°†è‡ªåŠ¨å¤„ç†å¾…æ‰§è¡Œçš„ä»»åŠ¡');
                
                // è‡ªåŠ¨æ‰§è¡Œå¾…å¤„ç†çš„ç«‹å³æ‰§è¡Œä»»åŠ¡
                const pendingTasks = tasks.filter(t => t.status === 'pending' && t.type === 'immediate');
                pendingTasks.forEach(task => {
                    setTimeout(() => executeTask(task.id), Math.random() * 2000);
                });
            } else {
                btn.innerHTML = 'â–¶ï¸ å¯åŠ¨ç³»ç»Ÿ';
                btn.className = 'btn btn-primary';
                showAlert('warning', 'â¸ï¸ ç³»ç»Ÿå·²æš‚åœ');
            }
        }

        // åˆ·æ–°TokençŠ¶æ€ (æ¨¡æ‹ŸçœŸå®APIè°ƒç”¨)
        async function refreshTokenStatus() {
            try {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„Token API
                // ç°åœ¨å…ˆæ¨¡æ‹Ÿä¸€ä¸‹
                document.getElementById('tokenUsage').textContent = 'åŠ è½½ä¸­...';
                document.getElementById('blockStatus').textContent = 'æ£€æŸ¥ä¸­...';
                
                // æ¨¡æ‹ŸAPIå»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æ¨¡æ‹ŸTokenæ•°æ® (å®é™…åº”è¯¥è°ƒç”¨ccusageå‘½ä»¤)
                const mockData = {
                    totalTokens: Math.floor(Math.random() * 1000000),
                    totalCost: Math.random() * 10,
                    blockActive: Math.random() > 0.3,
                    remainingMinutes: Math.floor(Math.random() * 120)
                };
                
                document.getElementById('tokenUsage').textContent = formatNumber(mockData.totalTokens);
                document.getElementById('tokenCost').textContent = `$${mockData.totalCost.toFixed(2)}`;
                document.getElementById('blockStatus').textContent = mockData.blockActive ? 
                    `æ´»è·ƒ (${mockData.remainingMinutes}min)` : 'ç­‰å¾…ä¸­';
                    
                if (mockData.totalTokens > 800000) {
                    showAlert('warning', 'âš ï¸ Tokenä½¿ç”¨é‡è¾ƒé«˜ï¼Œå»ºè®®åˆç†å®‰æ’ä»»åŠ¡æ‰§è¡Œ');
                }
                
            } catch (error) {
                document.getElementById('tokenUsage').textContent = 'è·å–å¤±è´¥';
                document.getElementById('tokenCost').textContent = 'è·å–å¤±è´¥';
                document.getElementById('blockStatus').textContent = 'è·å–å¤±è´¥';
                showAlert('error', 'è·å–TokençŠ¶æ€å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // æ˜¾ç¤ºæé†’æ¶ˆæ¯
        function showAlert(type, message) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentNode.remove()" style="background: none; border: none; font-size: 18px; cursor: pointer; margin-left: 10px;">&times;</button>
            `;
            
            container.appendChild(alert);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 5000);
        }

        // HTMLè½¬ä¹‰
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ›´æ–°UI
        function updateUI() {
            updateTaskList();
            updateTaskCounter();
        }

        // å®šæœŸåˆ·æ–°TokençŠ¶æ€
        setInterval(refreshTokenStatus, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html>